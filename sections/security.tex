\section{Security}

We next prove the security of $\pedpopcomm$ with respect to the notion of security defined by $\FDKGAbort$.

\begin{theorem}
\label{thm:keygen-pedpopplus}
Assume $\NIZKUCR$ is an online-extractable zero-knowledge proof for the Schnorr
relation $\SchnorrR$.
Then, for $t \leq n/2$,
the $\pedpopcomm$ DKG is secure under aborts in the programmable random oracle model,
and realizes the idealized notion $\FDKGAbort$.
\end{theorem}

\begin{proof}
    To establish the proof of Theorem~\ref{thm:keygen-pedpopplus},
    we define a simulator $\SIM$ that is given black-box access to the static adversary $\adv$.

    \medskip

    \paragraph{\bf Setup.}
    \begin{itemize}
        \item $\SIM$ runs the adversary,
        and receives the set $\corrupt$.
        $\SIM$ then sets $\honest \gets \set{n} \setminus \corrupt$.
        $\SIM$ outputs $\corrupt$ to the functionality $\FDKGAbort$.
        \item $\SIM$ receives $\dkgchal \in \Gr$ from $\FDKGAbort$.
        \item $SIM$ initializes the table $\QSchnorr \gets \emptyset$
    \end{itemize}

    \medskip

    \paragraph{\bf Simulating Random Oracle Queries.}
    \chelsea{TODO}

    \medskip

    \paragraph{\bf Round 0.}
    To simulate the initial round of the DKG,
    $\SIM$ follows the protocol honestly for each party $i \in \honest$.
    \chelsea{Discuss how $H_1$ is simulated}

    \medskip

    \paragraph{\bf Round 1.}
    To simulate Round~1 of the DKG,
    $\SIM$ does the following:
    \begin{itemize}
    \item Derive $\sid$ honestly.
    \item  For each honest party $i \in \honest$,
    sample $H_i \rgets \Zq$.
    \item When the adversary queries party $k \in \honest$,
    output $H_k$.
    \end{itemize}

    \medskip

    \paragraph{\bf Round 2.}
    On input \chelsea{TODO},
    to simulate Round~1 of the DKG,
    $\SIM$ does the following:
    \begin{itemize}
      \item For each corrupt party $j \in \corrupt$,
      look up $(\sid, j, C_j[0]) \gets \QSchnorrR[H_j]$.
      \item If any $H_j$ does not correspond to a valid entry or to the current $\sim$,
      follow the remainder of Round~2 honestly for all honest participants
        (there is no need to simulate as honest parties will abort in a later
        round due to invalid validity checks).
      \item Otherwise, for all honest parties $i \in \honest, i \neq \simid$,
      follow Round~2 as defined in the protocol.
      \item However, for party $\simid$,
        do as follows:
        \begin{enumerate}
    \item Randomly sample corrupt parties' shares $\share_{\simid,j} \rgets \Zq$ for all $j \in \corrupt$.
    \item Set
          \begin{equation}
            \label{eq:simid-comm}
C[0]_{\simid} \gets \dkgchal \cdot
              \prod_{k \in \honest, k  \neq \simid} (C[0]_{k})^{-1} \cdot
              \prod_{j \in \corrupt} (C[0]_{j})^{-1}
          \end{equation}
          where $C[0]_{k}$ are from the honest parties $k \in \honest, k \neq \simid$ polynomial commitments $C$.
			  \item Compute the Lagrange polynomials $\{L'_0(Z), \{L'_{j}(Z)\}_{j \in \corrupt}\}$ for the set
          (of $x$-coordinates) $\{ 0\cup\corrupt \}$,
          as defined in Section~\ref{prelim:secret-sharing}.
        \item For $\ell \in \{ 1, \ldots, \tcor\}$, set the remaining commitments, as follows:
          \[ C_\simid[\ell] \gets C_\simid[0]^{L'_0(\ell)} \cdot
            \prod_{j \in \corrupt \cup \{ 0\}} (g^{\share_{\simid,j}})^{L'_j(\ell)} \]
        \item Generate a simulated zero-knowledge proof $\pi_\simid$ of $\SchnorrR$ for $C[0]_\simid$.
            \chelsea{TODO describe how}
        \item Output $\{ (C_k, \pi_k)\}_{k \in \honest}$.
      \end{enumerate}
    \end{itemize}

    \paragraph{\bf Round 3.}
    On input \chelsea{TODO}
    to simulate Round~1 of the DKG,
    $\SIM$ does the following:
    \begin{itemize}
      \item Perform verification steps honestly;
        if any verification step fails, abort the protocol.
      \item Otherwise,
    \end{itemize}

\end{proof}
